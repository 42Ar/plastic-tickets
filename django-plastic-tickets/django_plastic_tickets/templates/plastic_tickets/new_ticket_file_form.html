{% load i18n %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="form-group">
        <h4>Basic information</h4>
        <small>
            {% blocktrans %}
                The basic information you <b>have to</b> choose yourself.
            {% endblocktrans %}
        </small>
    </div>

    <div class="form-group">
        <label for="count">
            {% trans "Count:" %}
        </label>
        <label aria-describedby="count_desc">
            <input class="form-control" type="number" id="count" min="1"
                   value="1">
        </label>
        <small id="count_desc" class="form-text">
            {% blocktrans %}
                How many times do you want to have this model printed?
            {% endblocktrans %}
        </small>
    </div>

    <div class="form-group">
        <label for="production_method">
            {% trans "Production method:" %}
        </label>
        <label>
            <select class="select2-dropdown" id="production_method">
                {% for type in production_methods %}
                    <option>{{ type }}</option>
                {% endfor %}
            </select>
        </label>
        <small id="production_method_desc" class="form-text">
            {% blocktrans %}
                Which production method should be used?
            {% endblocktrans %}
        </small>
        <small class="form-text">
            {% blocktrans %}
                Here is a quick description of your current selection:
            {% endblocktrans %}
        </small>
        <small id="production_method_summary">
            Placeholder: Please enable JavaScript!
        </small>
    </div>

    <div class="form-group">
        <label for="material_type">
            {% trans "Material type:" %}
        </label>
        <label>
            <select class="select2-dropdown" id="material_type">
                {% for type in material_types %}
                    <option>{{ type }}</option>
                {% endfor %}
            </select>
        </label>
        <small id="material_type_desc" class="form-text">
            {% blocktrans %}
                Which material should be used?
            {% endblocktrans %}
        </small>
        <small class="form-text">
            {% blocktrans %}
                Here is a quick description of your current selection:
            {% endblocktrans %}
        </small>
        <small id="material_type_summary">
            Placeholder: Please enable JavaScript!
        </small>
    </div>

    <div class="form-group">
        <label for="material_color">
            {% trans "Material color:" %}
        </label>
        <label>
            <select class="select2-dropdown" id="material_color">
                <option>Black</option>
                <option>Green</option>
            </select>
        </label>
        <small id="material_type_desc" class="form-text">
            {% blocktrans %}
                Which color should the material have?
            {% endblocktrans %}
        </small>
    </div>

    <div class="form-group">
        <h4>Advanced information</h4>
        <small>
            {% blocktrans %}
                The advanced information you <em>can</em> choose yourself.
                <br>
                If not specified, we will take care of this.
            {% endblocktrans %}
        </small>
    </div>

    <button type="submit" class="btn btn-primary">{% trans "Save" %}</button>
    <button type="reset" class="btn btn-secondary">{% trans "Reset" %}</button>
</form>

<script type="text/javascript">
    const tree = {{js_data|safe}};
    console.log(tree);

    pm = document.getElementById('production_method');
    mt = document.getElementById('material_type');

    pm_desc = document.getElementById('production_method_summary');

    pm.onchange = function (option) {
        pm_desc.innerHTML = tree[pm.selectedIndex].description;

        mt.options.length = 0;
        for (let material in tree[pm.selectedIndex].material_types) {
            console.log(material);
            mt.options.add(new Option(tree[pm.selectedIndex].material_types[material].name));
        }
    };

    pm.onload = pm.onchange;
</script>
